<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1,width=device-width,minimal-ui" /><meta name="format-detection" content="telephone=no"><meta name="robots" content="noindex"><meta http-equiv="cache-control" content="no-cache"/><meta http-equiv="Expires" content="-1" />
    <meta name="apple-mobile-web-app-capable" content="yes"/><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta http-equiv="x-dns-prefetch-control" content="on" />
    <meta name="apple-mobile-web-app-title" content="">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta name="HandheldFriendly" content="true">
    <!-- uc强制竖屏 -->
    <meta name="screen-orientation" content="portrait">
    <title>{% .title %}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vant@1.6/lib/index.css">
    <style>
        .content{

        }

        </style>

</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vant@1.6/lib/vant.min.js"></script>
<script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script>
<div id="app" style="min-height:100vh;height:100%;">



            <table width="100%">
                <thead>
                <tr><th><input v-model="list_url" style="width:100%" type="url" placeholder="请输入目录网址" /></th><th width="100"><a href="javascript:;" @click="getList">提交解析</a></th></tr>
                </thead>
                <tbody>
                <tr>
                    <td><span v-if="list_data.name">{{list_data.name}} 共 {{list_data.total}} 集</span></td>
                </tr>
                <tr v-for="item of list_data.links">
                    <td><span></span><span>{{item.title}}</span> {{item.url}}</td>
                </tr>
                </tbody>
            </table>
    <van-overlay :show="show" @click="show = false" />
</div>
<script>
    var app= new Vue({
        el:"#app",
        data:function(){
            return {
                baseurl:"",
                // 目录url
                list_url:"http://www.ting56.com/mp3/5257.html",
                list_data:{},
                tmp:null,
                show:true,
            }
        },
        mounted:function(){
            var loc = location.href;
            this.baseurl = loc.split("/api/")[0]
        },
        methods:{
            getList:function(){
                var self=this;
                var u= $.trim(this.list_url);
                if(!u){
                    return;
                }
                this.post(this.baseurl+"/api/scrapy/entry/process",{url:this.list_url},function (ret) {
                    self.list_data = ret;
                    console.log(ret)
                });

            },




            post(url , data , success , fail){

                return $.ajax({
                    url :url,
                    cache : false,
                    type : "POST",
                    contentType : 'application/json',
                    dataType : 'json',
                    data :JSON.stringify(data),
                    success : function(data) {
                        if(data.success){
                            if(success){success(data.data,data)}
                        }else{
                            if(fail){fail(data.message,data)}
                        }
                    },
                    error:function(data){
                        console.log(data)
                        if(fail){fail(data.message,data)}
                    }
                });

            }

        }
    });
</script>
</body>
</html>